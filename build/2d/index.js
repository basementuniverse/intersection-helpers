!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var r in n)("object"==typeof exports?exports:t)[r]=n[r]}}(this,(()=>{return t={395:t=>{const e=(t,e=0,n=1)=>t<e?e:t>n?n:t,n=t=>t>=0?t-Math.floor(t):t-Math.ceil(t),r=(t,e,n)=>t+(e-t)*n,s=(t=.5,e=.5,n=2)=>{let r=0;for(let t=n;t--;)r+=Math.random();return t+(r-n/2)/(n/2)*e},i=t=>{let e=1;for(let n=2;n<=t;n++)e*=n;return e},o=(t,e)=>1===e?t.map((t=>[t])):t.reduce(((n,r,s)=>[...n,...o(t.slice(0,s).concat(t.slice(s+1)),e-1).map((t=>[r,...t]))]),[]),c=(t,e)=>1===e?t.map((t=>[t])):t.reduce(((n,r,s)=>[...n,...c(t.slice(s+1),e-1).map((t=>[r,...t]))]),[]),a=(t,e)=>Array(e).fill(0).map(((e,n)=>t(n))),u=(t,e=".")=>Object.keys(t).reduce(((n,r)=>{if(t[r]instanceof Date)return{...n,[r]:t[r].toISOString()};if("object"!=typeof t[r]||!t[r])return{...n,[r]:t[r]};const s=u(t[r],e);return{...n,...Object.keys(s).reduce(((t,n)=>({...t,[`${r}${e}${n}`]:s[n]})),{})}}),{});t.exports={memoize:t=>{var e={};return function(...n){return e[n]??(e[n]=t.apply(this,n))}},floatEquals:(t,e,n=Number.EPSILON)=>Math.abs(t-e)<n,clamp:e,frac:n,round:(t,e=0)=>{const n=Math.pow(10,e);return Math.round(t*n+Number.EPSILON)/n},lerp:r,unlerp:(t,e,n)=>(n-t)/(e-t),blerp:(t,e,n,s,i,o)=>r(r(t,e,i),r(n,s,i),o),remap:(t,e,n,r,s)=>r+(t-e)*(s-r)/(n-e),smoothstep:(t,e,n)=>r(t,e,3*Math.pow(n,2)-2*Math.pow(n,3)),radians:t=>Math.PI/180*t,degrees:t=>180/Math.PI*t,randomBetween:(t,e)=>Math.random()*(e-t)+t,randomIntBetween:(t,e)=>Math.floor(Math.random()*(e-t+1))+t,cltRandom:s,cltRandomInt:(t,e)=>Math.floor(t+s(.5,.5,2)*(e+1-t)),weightedRandom:t=>{let e=t.reduce(((t,e)=>t+e),0),n=0;const r=Math.random()*e;for(;e>r;)e-=t[n++];return n-1},lerpArray:(t,s,i=r)=>{const o=s*(t.length-1),c=e(Math.trunc(o),0,t.length-1);return i(t[c]||0,t[c+1]||0,n(o))},dot:(t,e)=>t.reduce(((t,n,r)=>t+n*e[r]),0),factorial:i,npr:(t,e)=>i(t)/i(t-e),ncr:(t,e)=>i(t)/(i(e)*i(t-e)),permutations:o,combinations:c,cartesian:(...t)=>t.reduce(((t,e)=>t.flatMap((t=>e.map((e=>[...t,e]))))),[[]]),times:a,range:t=>a((t=>t),t),zip:(...t)=>a((e=>t.map((t=>t[e]))),Math.max(...t.map((t=>t.length)))),at:(t,e)=>t[e<0?t.length-Math.abs(e+1)%t.length-1:e%t.length],peek:t=>{if(t.length)return t[t.length-1]},ind:(t,e,n)=>t+e*n,pos:(t,e)=>[t%e,Math.floor(t/e)],chunk:(t,e)=>a((n=>t.slice(n*e,n*e+e)),Math.ceil(t.length/e)),shuffle:t=>t.slice().sort((()=>Math.random()-.5)),flat:u,unflat:(t,e=".")=>{let n,r,s,i,o={};for(s in t){for(r=s.split(e),n=o,i=0;i<r.length-1;i++)r[i]in n||(isFinite(r[i+1])?n[r[i]]=[]:n[r[i]]={}),n=n[r[i]];n[r[r.length-1]]=t[s]}return o},split:(t,e)=>{const n=[];let r=[];for(const s of t)e(s)?(r.length&&n.push(r),r=[s]):r.push(s);return n.push(r),n},pluck:(t,...e)=>e.reduce(((e,n)=>Object.assign(e,{[n]:t[n]})),{}),exclude:(t,...e)=>Object.fromEntries(Object.entries(t).filter((([t])=>!e.includes(t))))}},430:t=>{const e=(t,e)=>Array(e).fill(0).map(((e,n)=>t(n))),n=(t,e)=>t.reduce(((t,n,r)=>t+n*e[r]),0),r=t=>"object"==typeof t&&"x"in t&&"y"in t,s=t=>"object"==typeof t&&"x"in t&&"y"in t&&"z"in t,i=(t,e)=>t||e?r(t)?{x:t.x||0,y:t.y||0}:{x:t,y:e??t}:{x:0,y:0};i.components=t=>[t.x,t.y],i.fromComponents=t=>i(...t.slice(0,2)),i.ux=()=>i(1,0),i.uy=()=>i(0,1),i.add=(t,e)=>({x:t.x+(e.x??e),y:t.y+(e.y??e)}),i.sub=(t,e)=>({x:t.x-(e.x??e),y:t.y-(e.y??e)}),i.mul=(t,e)=>({x:t.x*(e.x??e),y:t.y*(e.y??e)}),i.scale=(t,e)=>i.mul(t,e),i.div=(t,e)=>({x:t.x/(e.x??e),y:t.y/(e.y??e)}),i.len=t=>Math.sqrt(t.x*t.x+t.y*t.y),i.manhattan=t=>Math.abs(t.x)+Math.abs(t.y),i.nor=t=>{let e=i.len(t);return e?{x:t.x/e,y:t.y/e}:i()},i.dot=(t,e)=>t.x*e.x+t.y*e.y,i.rot=(t,e)=>{let n=Math.sin(e),r=Math.cos(e);return{x:r*t.x-n*t.y,y:n*t.x+r*t.y}},i.rotf=(t,e)=>{switch(e){case 1:return i(t.y,-t.x);case-1:return i(-t.y,t.x);case 2:case-2:return i(-t.x,-t.y);default:return t}},i.cross=(t,e)=>t.x*e.y-t.y*e.x,i.eq=(t,e)=>t.x===e.x&&t.y===e.y,i.rad=t=>Math.atan2(t.y,t.x),i.cpy=t=>i(t),i.map=(t,e)=>({x:e(t.x,"x"),y:e(t.y,"y")}),i.str=(t,e=", ")=>`${t.x}${e}${t.y}`,i.swiz=(t,e="..")=>{const n=[];return e.split("").forEach(((e,r)=>{switch(e){case"x":case"u":n.push(t.x);break;case"y":case"v":n.push(t.y);break;case"X":case"U":n.push(-t.x);break;case"Y":case"V":n.push(-t.y);break;case"0":default:n.push(0);break;case"1":n.push(1);break;case".":n.push([t.x,t.y][r]??0)}})),n},i.polar=t=>({r:i.len(t),theta:Math.atan2(t.y,t.x)}),i.fromPolar=(t,e)=>i(t*Math.cos(e),t*Math.sin(e));const o=(t,e,n)=>t||e||n?s(t)?{x:t.x||0,y:t.y||0,z:t.z||0}:r(t)?{x:t.x||0,y:t.y||0,z:e||0}:{x:t,y:e??t,z:n??t}:{x:0,y:0,z:0};o.components=t=>[t.x,t.y,t.z],o.fromComponents=t=>o(...t.slice(0,3)),o.ux=()=>o(1,0,0),o.uy=()=>o(0,1,0),o.uz=()=>o(0,0,1),o.add=(t,e)=>({x:t.x+(e.x??e),y:t.y+(e.y??e),z:t.z+(e.z??e)}),o.sub=(t,e)=>({x:t.x-(e.x??e),y:t.y-(e.y??e),z:t.z-(e.z??e)}),o.mul=(t,e)=>({x:t.x*(e.x??e),y:t.y*(e.y??e),z:t.z*(e.z??e)}),o.scale=(t,e)=>o.mul(t,e),o.div=(t,e)=>({x:t.x/(e.x??e),y:t.y/(e.y??e),z:t.z/(e.z??e)}),o.len=t=>Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z),o.manhattan=t=>Math.abs(t.x)+Math.abs(t.y)+Math.abs(t.z),o.nor=t=>{let e=o.len(t);return e?{x:t.x/e,y:t.y/e,z:t.z/e}:o()},o.dot=(t,e)=>t.x*e.x+t.y*e.y+t.z*e.z,o.rot=(t,e)=>o(o.dot(o.fromComponents(c.row(e,1)),t),o.dot(o.fromComponents(c.row(e,2)),t),o.dot(o.fromComponents(c.row(e,3)),t)),o.rotx=(t,e)=>o(t.x,t.y*Math.cos(e)-t.z*Math.sin(e),t.y*Math.sin(e)+t.z*Math.cos(e)),o.roty=(t,e)=>o(t.x*Math.cos(e)+t.z*Math.sin(e),t.y,-t.x*Math.sin(e)+t.z*Math.cos(e)),o.rotz=(t,e)=>o(t.x*Math.cos(e)-t.y*Math.sin(e),t.x*Math.sin(e)+t.y*Math.cos(e),t.z),o.rotq=(t,e)=>{if(4!==e.length)return o();const n=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]);if(0===n)return o();const r=[e[0]/n,e[1]/n,e[2]/n,e[3]/n],s=o(...r.slice(0,3)),i=r[3];return o.add(o.add(o.mul(s,2*o.dot(s,t)),o.mul(t,i*i-o.dot(s,s))),o.mul(o.cross(s,t),2*i))},o.rota=(t,e)=>o.rotz(o.roty(o.rotx(t,e.x),e.y),e.z),o.cross=(t,e)=>o(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x),o.eq=(t,e)=>t.x===e.x&&t.y===e.y&&t.z===e.z,o.radx=t=>Math.atan2(t.z,t.y),o.rady=t=>Math.atan2(t.x,t.y),o.radz=t=>Math.atan2(t.y,t.z),o.cpy=t=>o(t),o.map=(t,e)=>({x:e(t.x,"x"),y:e(t.y,"y"),z:e(t.z,"z")}),o.str=(t,e=", ")=>`${t.x}${e}${t.y}${e}${t.z}`,o.swiz=(t,e="...")=>{const n=[];return e.split("").forEach(((e,r)=>{switch(e){case"x":case"u":case"r":n.push(t.x);break;case"y":case"v":case"g":n.push(t.y);break;case"z":case"w":case"b":n.push(t.z);break;case"X":case"U":case"R":n.push(-t.x);break;case"Y":case"V":case"G":n.push(-t.y);break;case"Z":case"W":case"B":n.push(-t.z);break;case"0":default:n.push(0);break;case"1":n.push(1);break;case".":n.push([t.x,t.y,t.z][r]??0)}})),n},o.polar=t=>{let e=o.len(t);return{r:e,theta:Math.acos(t.y/e),phi:Math.atan2(t.z,t.x)}},o.fromPolar=(t,e,n)=>{const r=Math.sin(e);return o(t*r*Math.cos(n),t*Math.cos(e),t*r*Math.sin(n))};const c=(t=4,e=4,n=[])=>({m:t,n:e,entries:n.concat(Array(t*e).fill(0)).slice(0,t*e)});c.identity=t=>c(t,t,Array(t*t).fill(0).map(((e,n)=>+(Math.floor(n/t)===n%t)))),c.get=(t,e,n)=>t.entries[n-1+(e-1)*t.n],c.set=(t,e,n,r)=>{t.entries[n-1+(e-1)*t.n]=r},c.row=(t,e)=>{const n=(e-1)*t.n;return t.entries.slice(n,n+t.n)},c.col=(t,n)=>e((e=>c.get(t,e+1,n)),t.m),c.add=(t,e)=>t.m===e.m&&t.n===e.n&&c.map(t,((t,n)=>t+e.entries[n])),c.sub=(t,e)=>t.m===e.m&&t.n===e.n&&c.map(t,((t,n)=>t-e.entries[n])),c.mul=(t,e)=>{if(t.n!==e.m)return!1;const r=c(t.m,e.n);for(let s=1;s<=t.m;s++)for(let i=1;i<=e.n;i++)c.set(r,s,i,n(c.row(t,s),c.col(e,i)));return r},c.mulv=(t,e)=>{let a,u,l;if(s(e)?(u=o.components(e),a=3,l=o.fromComponents):r(e)?(u=i.components(e),a=2,l=i.fromComponents):(u=e,a=e.length??0,l=t=>t),t.n!==a)return!1;const v=[];for(let e=1;e<=t.m;e++)v.push(n(c.row(t,e),u));return l(v)},c.scale=(t,e)=>c.map(t,(t=>t*e)),c.trans=t=>c(t.n,t.m,e((e=>c.col(t,e+1)),t.n).flat()),c.minor=(t,e,n)=>{if(t.m!==t.n)return!1;const r=[];for(let s=1;s<=t.m;s++)if(s!==e)for(let e=1;e<=t.n;e++)e!==n&&r.push(c.get(t,s,e));return c(t.m-1,t.n-1,r)},c.det=t=>{if(t.m!==t.n)return!1;if(1===t.m)return t.entries[0];if(2===t.m)return t.entries[0]*t.entries[3]-t.entries[1]*t.entries[2];let e=0,n=1;for(let r=1;r<=t.n;r++)e+=n*t.entries[r-1]*c.det(c.minor(t,1,r)),n*=-1;return e},c.nor=t=>{if(t.m!==t.n)return!1;const e=c.det(t);return c.map(t,(t=>t*e))},c.adj=t=>{const e=c(t.m,t.n);for(let n=1;n<=t.m;n++)for(let r=1;r<=t.n;r++)c.set(e,n,r,c.det(c.minor(t,n,r)));const n=c.map(e,((t,e)=>t*(e%2?-1:1)));return c.trans(n)},c.inv=t=>{if(t.m!==t.n)return!1;const e=c.det(t);return 0!==e&&c.scale(c.adj(t),1/e)},c.eq=(t,e)=>t.m===e.m&&t.n===e.n&&c.str(t)===c.str(e),c.cpy=t=>c(t.m,t.n,[...t.entries]),c.map=(t,e)=>c(t.m,t.n,t.entries.map(e)),c.str=(t,n=", ",r="\n")=>((t,n)=>e((e=>t.slice(e*n,e*n+n)),Math.ceil(t.length/n)))(t.entries,t.n).map((t=>t.join(n))).join(r),t.exports={vec2:i,vec3:o,mat:c}},513:t=>{function e(t,e,n){n=n||0;var r,s,i,o,c,a,u,l=[0,0];return r=t[1][1]-t[0][1],s=t[0][0]-t[1][0],i=r*t[0][0]+s*t[0][1],o=e[1][1]-e[0][1],c=e[0][0]-e[1][0],a=o*e[0][0]+c*e[0][1],z(u=r*c-o*s,0,n)||(l[0]=(c*i-s*a)/u,l[1]=(r*a-o*i)/u),l}function n(t,e,n,r){var s=e[0]-t[0],i=e[1]-t[1],o=r[0]-n[0],c=r[1]-n[1];if(o*i-c*s==0)return!1;var a=(s*(n[1]-t[1])+i*(t[0]-n[0]))/(o*i-c*s),u=(o*(t[1]-n[1])+c*(n[0]-t[0]))/(c*s-o*i);return a>=0&&a<=1&&u>=0&&u<=1}function r(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(n[0]-t[0])*(e[1]-t[1])}function s(t,e,n){return r(t,e,n)>0}function i(t,e,n){return r(t,e,n)>=0}function o(t,e,n){return r(t,e,n)<0}function c(t,e,n){return r(t,e,n)<=0}t.exports={decomp:function(t){var e=b(t);return e.length>0?M(t,e):[t]},quickDecomp:function t(e,n,r,a,u,l,m){l=l||100,m=m||0,u=u||25,n=void 0!==n?n:[],r=r||[],a=a||[];var p=[0,0],y=[0,0],g=[0,0],b=0,M=0,z=0,I=0,O=0,S=0,E=0,L=[],N=[],A=e,j=e;if(j.length<3)return n;if(++m>l)return console.warn("quickDecomp: max level ("+l+") reached."),n;for(var w=0;w<e.length;++w)if(d(A,w)){r.push(A[w]),b=M=Number.MAX_VALUE;for(var _=0;_<e.length;++_)s(f(A,w-1),f(A,w),f(A,_))&&c(f(A,w-1),f(A,w),f(A,_-1))&&(g=P(f(A,w-1),f(A,w),f(A,_),f(A,_-1)),o(f(A,w+1),f(A,w),g)&&(z=v(A[w],g))<M&&(M=z,y=g,S=_)),s(f(A,w+1),f(A,w),f(A,_+1))&&c(f(A,w+1),f(A,w),f(A,_))&&(g=P(f(A,w+1),f(A,w),f(A,_),f(A,_+1)),s(f(A,w-1),f(A,w),g)&&(z=v(A[w],g))<b&&(b=z,p=g,O=_));if(S===(O+1)%e.length)g[0]=(y[0]+p[0])/2,g[1]=(y[1]+p[1])/2,a.push(g),w<O?(h(L,A,w,O+1),L.push(g),N.push(g),0!==S&&h(N,A,S,A.length),h(N,A,0,w+1)):(0!==w&&h(L,A,w,A.length),h(L,A,0,O+1),L.push(g),N.push(g),h(N,A,S,w+1));else{if(S>O&&(O+=e.length),I=Number.MAX_VALUE,O<S)return n;for(_=S;_<=O;++_)i(f(A,w-1),f(A,w),f(A,_))&&c(f(A,w+1),f(A,w),f(A,_))&&(z=v(f(A,w),f(A,_)))<I&&x(A,w,_)&&(I=z,E=_%e.length);w<E?(h(L,A,w,E+1),0!==E&&h(N,A,E,j.length),h(N,A,0,w+1)):(0!==w&&h(L,A,w,j.length),h(L,A,0,E+1),h(N,A,E,w+1))}return L.length<N.length?(t(L,n,r,a,u,l,m),t(N,n,r,a,u,l,m)):(t(N,n,r,a,u,l,m),t(L,n,r,a,u,l,m)),n}return n.push(e),n},isSimple:function(t){var e,r=t;for(e=0;e<r.length-1;e++)for(var s=0;s<e-1;s++)if(n(r[e],r[e+1],r[s],r[s+1]))return!1;for(e=1;e<r.length-2;e++)if(n(r[0],r[r.length-1],r[e],r[e+1]))return!1;return!0},removeCollinearPoints:function(t,e){for(var n=0,r=t.length-1;t.length>3&&r>=0;--r)l(f(t,r-1),f(t,r),f(t,r+1),e)&&(t.splice(r%t.length,1),n++);return n},removeDuplicatePoints:function(t,e){for(var n=t.length-1;n>=1;--n)for(var r=t[n],s=n-1;s>=0;--s)I(r,t[s],e)&&t.splice(n,1)},makeCCW:function(t){for(var e=0,n=t,r=1;r<t.length;++r)(n[r][1]<n[e][1]||n[r][1]===n[e][1]&&n[r][0]>n[e][0])&&(e=r);return!s(f(t,e-1),f(t,e),f(t,e+1))&&(function(t){for(var e=[],n=t.length,r=0;r!==n;r++)e.push(t.pop());for(r=0;r!==n;r++)t[r]=e[r]}(t),!0)}};var a=[],u=[];function l(t,e,n,s){if(s){var i=a,o=u;i[0]=e[0]-t[0],i[1]=e[1]-t[1],o[0]=n[0]-e[0],o[1]=n[1]-e[1];var c=i[0]*o[0]+i[1]*o[1],l=Math.sqrt(i[0]*i[0]+i[1]*i[1]),v=Math.sqrt(o[0]*o[0]+o[1]*o[1]);return Math.acos(c/(l*v))<s}return 0===r(t,e,n)}function v(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function f(t,e){var n=t.length;return t[e<0?e%n+n:e%n]}function h(t,e,n,r){for(var s=n;s<r;s++)t.push(e[s])}function d(t,e){return o(f(t,e-1),f(t,e),f(t,e+1))}var m=[],p=[];function y(t,n,r){var s,o,a=m,u=p;if(i(f(t,n+1),f(t,n),f(t,r))&&c(f(t,n-1),f(t,n),f(t,r)))return!1;o=v(f(t,n),f(t,r));for(var l=0;l!==t.length;++l)if((l+1)%t.length!==n&&l!==n&&i(f(t,n),f(t,r),f(t,l+1))&&c(f(t,n),f(t,r),f(t,l))&&(a[0]=f(t,n),a[1]=f(t,r),u[0]=f(t,l),u[1]=f(t,l+1),s=e(a,u),v(f(t,n),s)<o))return!1;return!0}function x(t,e,r){for(var s=0;s!==t.length;++s)if(s!==e&&s!==r&&(s+1)%t.length!==e&&(s+1)%t.length!==r&&n(f(t,e),f(t,r),f(t,s),f(t,s+1)))return!1;return!0}function g(t,e,n,r){var s=r||[];if(function(t){t.length=0}(s),e<n)for(var i=e;i<=n;i++)s.push(t[i]);else{for(i=0;i<=n;i++)s.push(t[i]);for(i=e;i<t.length;i++)s.push(t[i])}return s}function b(t){for(var e=[],n=[],r=[],s=[],i=Number.MAX_VALUE,o=0;o<t.length;++o)if(d(t,o))for(var c=0;c<t.length;++c)if(y(t,o,c)){n=b(g(t,o,c,s)),r=b(g(t,c,o,s));for(var a=0;a<r.length;a++)n.push(r[a]);n.length<i&&(e=n,i=n.length,e.push([f(t,o),f(t,c)]))}return e}function M(t,e){if(0===e.length)return[t];if(e instanceof Array&&e.length&&e[0]instanceof Array&&2===e[0].length&&e[0][0]instanceof Array){for(var n=[t],r=0;r<e.length;r++)for(var s=e[r],i=0;i<n.length;i++){var o=M(n[i],s);if(o){n.splice(i,1),n.push(o[0],o[1]);break}}return n}return s=e,r=t.indexOf(s[0]),i=t.indexOf(s[1]),-1!==r&&-1!==i&&[g(t,r,i),g(t,i,r)]}function P(t,e,n,r,s){s=s||0;var i=e[1]-t[1],o=t[0]-e[0],c=i*t[0]+o*t[1],a=r[1]-n[1],u=n[0]-r[0],l=a*n[0]+u*n[1],v=i*u-a*o;return z(v,0,s)?[0,0]:[(u*c-o*l)/v,(i*l-a*c)/v]}function z(t,e,n){return n=n||0,Math.abs(t-e)<=n}function I(t,e,n){return z(t[0],e[0],n)&&z(t[1],e[1],n)}},674:function(t,e,n){"use strict";var r,s=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var s=Object.getOwnPropertyDescriptor(e,n);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,s)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),i=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),o=this&&this.__importStar||(r=function(t){return r=Object.getOwnPropertyNames||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[e.length]=n);return e},r(t)},function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n=r(t),o=0;o<n.length;o++)"default"!==n[o]&&s(e,t,n[o]);return i(e,t),e}),c=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||s(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),e.distance=function(t,e){return u.vec2.len(u.vec2.sub(t,e))},e.angle=function(t,e){if((0,v.vectorsAlmostEqual)(t,e))return 0;const n=u.vec2.rad(u.vec2.sub(e,t))%(2*Math.PI);return n<0?n+2*Math.PI:n},e.angleBetween=function(t,e){let n=(0,h.isRay)(t)?m(t,1):t,r=(0,h.isRay)(e)?m(e,1):e;if((0,v.vectorAlmostZero)(u.vec2.sub(n.end,n.start))||(0,v.vectorAlmostZero)(u.vec2.sub(r.end,r.start)))return 0;const s=u.vec2.nor(u.vec2.sub(n.end,n.start)),i=u.vec2.nor(u.vec2.sub(r.end,r.start)),o=(0,a.clamp)(u.vec2.dot(s,i),-1,1),c=u.vec2.cross(s,i),l=Math.atan2(c,o);return l<0?l+2*Math.PI:l},e.pointsAreCollinear=d,e.lineToRay=function(t){return{origin:t.start,direction:u.vec2.nor(u.vec2.sub(t.end,t.start))}},e.rayToLine=m,e.aabb=function(t){if((0,h.isLine)(t))return{position:(0,u.vec2)(Math.min(t.start.x,t.end.x),Math.min(t.start.y,t.end.y)),size:(0,u.vec2)(Math.abs(t.end.x-t.start.x),Math.abs(t.end.y-t.start.y))};if((0,h.isRectangle)(t)){const e=y(t),n=(0,u.vec2)(Math.min(...e.map((t=>t.x))),Math.min(...e.map((t=>t.y))));return{position:n,size:(0,u.vec2)(Math.max(...e.map((t=>t.x)))-n.x,Math.max(...e.map((t=>t.y)))-n.y)}}if((0,h.isCircle)(t))return{position:u.vec2.sub(t.position,(0,u.vec2)(t.radius,t.radius)),size:(0,u.vec2)(2*t.radius)};if((0,h.isPolygon)(t)){const e=(0,u.vec2)(Math.min(...t.vertices.map((t=>t.x))),Math.min(...t.vertices.map((t=>t.y))));return{position:e,size:(0,u.vec2)(Math.max(...t.vertices.map((t=>t.x)))-e.x,Math.max(...t.vertices.map((t=>t.y)))-e.y)}}return null},e.aabbToRectangle=function(t){return{position:u.vec2.add(t.position,u.vec2.div(t.size,2)),size:t.size,rotation:0}},e.aabbsOverlap=function(t,e){const n=(0,v.overlapInterval)({min:t.position.x,max:t.position.x+t.size.x},{min:e.position.x,max:e.position.x+e.size.x}),r=(0,v.overlapInterval)({min:t.position.y,max:t.position.y+t.size.y},{min:e.position.y,max:e.position.y+e.size.y});return n&&r?{intersects:!0,overlap:{position:(0,u.vec2)(n.min,r.min),size:(0,u.vec2)(n.max-n.min,r.max-r.min)}}:{intersects:!1}},e.pointInAABB=function(t,e){const{position:n,size:r}=e,s=n,i=u.vec2.add(n,r),o=(0,v.valueInInterval)(t.x,{min:s.x,max:i.x})&&(0,v.valueInInterval)(t.y,{min:s.y,max:i.y});let c;if(o){const e=[{x:s.x,y:t.y,d:Math.abs(t.x-s.x)},{x:i.x,y:t.y,d:Math.abs(t.x-i.x)},{x:t.x,y:s.y,d:Math.abs(t.y-s.y)},{x:t.x,y:i.y,d:Math.abs(t.y-i.y)}].reduce(((t,e)=>t.d<e.d?t:e));c=(0,u.vec2)(e.x,e.y)}else c=(0,u.vec2)((0,a.clamp)(t.x,s.x,i.x),(0,a.clamp)(t.y,s.y,i.y));const l=u.vec2.len(u.vec2.sub(t,c));return{intersects:o,closestPoint:c,distance:o?-l:l}},e.rectangleIsRotated=p,e.rectangleVertices=y,e.verticesToEdges=x,e.polygonIsConvex=b,e.polygonSelfIntersects=M,e.polygonIsValid=P,e.polygonWindingOrder=z,e.polygonArea=function(t){if(!P(t))return null;let e=0;for(let n=0;n<t.vertices.length;n++){const r=t.vertices[n],s=(0,a.at)(t.vertices,n+1);e+=u.vec2.cross(r,s)}return Math.abs(e)/2},e.polygonCentroid=I,e.polygonConvexHull=function(t,e){var n;if(!P(t))return null;if(b(t))return t;const r=null===(n=null==e?void 0:e.keepWindingOrder)||void 0===n||n,s=z(t),i=[...t.vertices].sort(((t,e)=>t.x!==e.x?t.x-e.x:t.y-e.y)),o=[];for(const t of i){for(;o.length>=2&&u.vec2.cross(u.vec2.sub(o[o.length-1],o[o.length-2]),u.vec2.sub(t,o[o.length-1]))<=0;)o.pop();o.push(t)}const c=[];for(let t=i.length-1;t>=0;--t){const e=i[t];for(;c.length>=2&&u.vec2.cross(u.vec2.sub(c[c.length-1],c[c.length-2]),u.vec2.sub(e,c[c.length-1]))<=0;)c.pop();c.push(e)}o.pop(),c.pop();const a=o.concat(c);return a.length<3?null:(r&&z({vertices:a})!==s&&a.reverse(),{vertices:O(a)})},e.optimisePolygon=function(t){if(t.vertices.length<3)return null;const e=function(t){const e=[],n=t.length;for(let r=0;r<n;r++){const n=(0,a.at)(t,r-1),s=t[r];d(n,s,(0,a.at)(t,r+1))||e.push(s)}return e}(function(t){const e=[],n=t.length;for(let r=0;r<n;r++){const n=t[r],s=(0,a.at)(t,r+1);(0,v.vectorsAlmostEqual)(n,s)||e.push(n)}return e}(t.vertices));return e.length<3?null:{vertices:e}},e.decomposePolygon=S,e.pointOnRay=function(t,e){const n=u.vec2.sub(t,e.origin),r=u.vec2.nor(e.direction),s=u.vec2.dot(n,r),i=u.vec2.add(e.origin,u.vec2.mul(r,Math.max(0,s))),o=u.vec2.len(u.vec2.sub(t,i));return{intersects:o<f.EPSILON&&s>=0,closestPoint:i,distance:o}},e.pointOnLine=E,e.pointInCircle=L,e.pointInRectangle=N,e.pointInPolygon=A,e.rayTraverseGrid=function(t,e,n,r,s=-1){if(e<=0)return{cells:[]};if((s=(0,a.clamp)(-1===s?1e4:s,0,1e4))<=0)return{cells:[]};n=u.vec2.map(n,Math.floor),r=u.vec2.map(r,Math.ceil);const i=u.vec2.nor(t.direction);if((0,v.vectorAlmostZero)(i))return{cells:[]};const o=[];let c=u.vec2.map(u.vec2.div(u.vec2.sub(t.origin,n),e),Math.floor);const l=u.vec2.sub(r,n);if(c.x<0||c.x>=l.x||c.y<0||c.y>=l.y){const s=w(t,{position:u.vec2.add(n,u.vec2.div(u.vec2.sub(r,n),2)),size:u.vec2.sub(r,n)});if(!s.intersects||!s.intersectionPoints)return{cells:o};const i=s.intersectionPoints[0];if(c=u.vec2.map(u.vec2.div(u.vec2.sub(i,n),e),Math.floor),c.x<0||c.x>=l.x||c.y<0||c.y>=l.y)return{cells:o}}const h=Math.sign(i.x),d=Math.sign(i.y),m={x:0!==i.x?Math.abs(e/i.x):1/0,y:0!==i.y?Math.abs(e/i.y):1/0},p=(0,u.vec2)(n.x+(c.x+(h>0?1:0))*e,n.y+(c.y+(d>0?1:0))*e),y={x:0!==i.x?Math.abs((p.x-t.origin.x)/i.x):1/0,y:0!==i.y?Math.abs((p.y-t.origin.y)/i.y):1/0};Math.abs(t.origin.x-p.x)<f.EPSILON&&(y.x=m.x),Math.abs(t.origin.y-p.y)<f.EPSILON&&(y.y=m.y),o.push((0,u.vec2)(c.x,c.y));let x=1;for(;x<s&&c.x>=0&&c.x<l.x&&c.y>=0&&c.y<l.y&&(y.x<y.y?(y.x+=m.x,c.x+=h):(y.y+=m.y,c.y+=d),!(c.x<0||c.x>=l.x||c.y<0||c.y>=l.y));)o.push((0,u.vec2)(c.x,c.y)),x++;return{cells:o}},e.rayIntersectsRay=function(t,e){const n=u.vec2.nor(t.direction),r=u.vec2.nor(e.direction);if((0,v.vectorAlmostZero)(n)||(0,v.vectorAlmostZero)(r))return{intersects:!1};const s=u.vec2.cross(n,r),i=u.vec2.sub(e.origin,t.origin);if(Math.abs(s)<f.EPSILON){if(Math.abs(u.vec2.cross(i,n))<f.EPSILON){const t=u.vec2.dot(i,n);if((t<=0||t>=0)&&u.vec2.dot(n,r)>1-f.EPSILON)return{intersects:!0}}return{intersects:!1}}const o=u.vec2.cross(i,r)/s,c=u.vec2.cross(i,n)/s;return o>=0&&c>=0?{intersects:!0,intersectionPoint:u.vec2.add(t.origin,u.vec2.mul(n,o))}:{intersects:!1}},e.rayIntersectsLine=j,e.rayIntersectsCircle=function(t,e){const n=u.vec2.nor(t.direction),r=u.vec2.sub(e.position,t.origin),s=u.vec2.dot(n,n),i=2*u.vec2.dot(n,u.vec2.mul(r,-1)),o=i*i-4*s*(u.vec2.dot(r,r)-e.radius*e.radius);if(o<-f.EPSILON)return{intersects:!1};if(Math.abs(o)<f.EPSILON){const e=-i/(2*s);return e>=0?{intersects:!0,intersectionPoints:[u.vec2.add(t.origin,u.vec2.mul(n,e))]}:{intersects:!1}}const c=Math.sqrt(o),a=(-i-c)/(2*s),l=(-i+c)/(2*s);if(l<0)return{intersects:!1};let v=[];return a>=0&&v.push(u.vec2.add(t.origin,u.vec2.mul(n,a))),l>=0&&v.push(u.vec2.add(t.origin,u.vec2.mul(n,l))),v=O(v),{intersects:v.length>0,intersectionPoints:v.length>0?v:void 0}},e.rayIntersectsRectangle=w,e.rayIntersectsPolygon=function(t,e){if(!P(e))return null;if(!b(e)){const n=S(e);return n?_(t,g(n)):null}return _(t,x(e.vertices))},e.lineIntersectsRay=function(t,e){return j(e,t)},e.lineIntersectsLine=k,e.lineIntersectsCircle=q,e.lineIntersectsRectangle=function(t,e){if((0,v.vectorAlmostZero)(e.size))return{intersects:!1};const n=y(e);if(N(t.start,e).intersects&&N(t.end,e).intersects)return{intersects:!0};let r=[];const s=x(n);for(const e of s){const n=k(t,e);n.intersects&&n.intersectionPoint&&r.push(n.intersectionPoint)}return r=O(r),r.length>1&&r.sort(((e,n)=>u.vec2.len(u.vec2.sub(e,t.start))-u.vec2.len(u.vec2.sub(n,t.start)))),{intersects:r.length>0,intersectionPoints:r.length>0?r:void 0}},e.lineIntersectsPolygon=function(t,e){if(!P(e))return null;if(!b(e)){const n=S(e);return n?C(t,e,g(n)):null}return C(t,e,x(e.vertices))},e.circleIntersectsCircle=function(t,e){const n=u.vec2.sub(e.position,t.position),r=u.vec2.len(n),s=t.radius+e.radius;if(r>s+f.EPSILON)return{intersects:!1};if(r<f.EPSILON&&Math.abs(t.radius-e.radius)<f.EPSILON)return{intersects:!0,minimumSeparation:u.vec2.mul(u.vec2.ux(),2*t.radius)};if(r<Math.abs(t.radius-e.radius)-f.EPSILON)return{intersects:!0,minimumSeparation:u.vec2.mul(u.vec2.nor(n),t.radius-r+e.radius)};const i=(t.radius*t.radius-e.radius*e.radius+r*r)/(2*r),o=Math.sqrt(Math.max(0,t.radius*t.radius-i*i)),c=u.vec2.add(t.position,u.vec2.mul(u.vec2.nor(n),i));if(Math.abs(r-s)<f.EPSILON)return{intersects:!0,intersectionPoints:[c],minimumSeparation:(0,u.vec2)()};const a=u.vec2.mul((0,u.vec2)({x:-n.y,y:n.x}),o/r);return{intersects:!0,intersectionPoints:[u.vec2.add(c,a),u.vec2.sub(c,a)],minimumSeparation:u.vec2.mul(u.vec2.nor(n),s-r)}},e.circleIntersectsRectangle=function(t,e){const n=x(y(e)),r=N(t.position,e),s=r.intersects,i=L(e.position,t).intersects,o=[];for(const e of n){const n=q(e,t);n.intersects&&n.intersectionPoints&&o.push(...n.intersectionPoints)}let c;if(c=Math.abs(r.distance)<f.EPSILON?(0,u.vec2)():r.distance<0?u.vec2.mul(u.vec2.nor(u.vec2.sub(r.closestPoint,t.position)),t.radius+Math.abs(r.distance)):u.vec2.mul(u.vec2.nor(u.vec2.sub(t.position,r.closestPoint)),t.radius-r.distance),(s||i)&&0===o.length)return{intersects:!0,minimumSeparation:c};const a=O(o);return a.length>0?{intersects:!0,intersectionPoints:a,minimumSeparation:c}:{intersects:!1}},e.circleIntersectsPolygon=function t(e,n,r){var s,i,o,c,a,l;if(!P(n))return null;const h=null!==(s=null==r?void 0:r.findMinimumSeparation)&&void 0!==s&&s,d=A(e.position,n),m=null!==(i=null==d?void 0:d.intersects)&&void 0!==i&&i;if(!b(n)){const s=S(n);if(!s)return null;const i=s.every((t=>{var n;const r=I(t);return!!r&&null!==(n=L(r,e).intersects)&&void 0!==n&&n})),l=g(s),d=R(e,l,m,i);if(d.intersects&&h){let i=0,l=null,h=(0,u.vec2)(),m=!0;for(;m&&(null===l||!(0,v.vectorsAlmostEqual)(l,h))&&++i<10;){let i=[],v=u.vec2.add(e.position,h);for(const t of s){const n=A(v,t);if(!n)continue;let r;r=Math.abs(n.distance)<f.EPSILON?(0,u.vec2)():n.distance<0?u.vec2.mul(u.vec2.nor(u.vec2.sub(n.closestPoint,v)),e.radius+Math.abs(n.distance)):u.vec2.mul(u.vec2.nor(u.vec2.sub(v,n.closestPoint)),e.radius-n.distance),i.push({separation:r,distance:Math.abs(n.distance)})}i=i.sort(((t,e)=>t.distance-e.distance)),l=u.vec2.cpy(h),h=u.vec2.add(h,(null===(o=i[0])||void 0===o?void 0:o.separation)||(0,u.vec2)()),m=null!==(a=null===(c=t({...e,position:u.vec2.add(e.position,u.vec2.mul(h,1.01))},n,{...r,findMinimumSeparation:!1}))||void 0===c?void 0:c.intersects)&&void 0!==a&&a}return{...d,minimumSeparation:h}}return d}const p=null!==(l=L(I(n),e).intersects)&&void 0!==l&&l,y=x(n.vertices),M=R(e,y,m,p);if(M.intersects&&h){let t;return t=Math.abs(d.distance)<f.EPSILON?(0,u.vec2)():d.distance<0?u.vec2.mul(u.vec2.nor(u.vec2.sub(d.closestPoint,e.position)),e.radius+Math.abs(d.distance)):u.vec2.mul(u.vec2.nor(u.vec2.sub(e.position,d.closestPoint)),e.radius-d.distance),{...M,minimumSeparation:t}}return M},e.rectangleIntersectsRectangle=function(t,e){if((0,v.vectorAlmostZero)(t.size)||(0,v.vectorAlmostZero)(e.size))return{intersects:!1};const n=y(t),r=y(e),s=x(n),i=x(r),o=[];for(const t of[...s,...i]){const e=u.vec2.sub(t.end,t.start),n=u.vec2.nor(u.vec2.rotf(e,-1));o.some((t=>Math.abs(u.vec2.dot(t,n))>1-f.EPSILON))||o.push(n)}let c=1/0,a=(0,u.vec2)();for(const t of o){const e=V(n,t),s=V(r,t);if(e.max<s.min||s.max<e.min)return{intersects:!1};const i=Math.min(e.max-s.min,s.max-e.min);i<c&&(c=i,a=t)}const l=[];for(const t of s)for(const e of i){const n=k(t,e);n.intersects&&n.intersectionPoint&&l.push(n.intersectionPoint)}const h=O(l),d=t.position,m=e.position,p=u.vec2.sub(m,d);u.vec2.dot(a,p)<0&&(a=u.vec2.mul(a,-1));const g=u.vec2.mul(a,c);return{intersects:!0,intersectionPoints:h.length>0?h:void 0,minimumSeparation:g}},e.rectangleIntersectsPolygon=function(t,e){if(!P(e))return null;if((0,v.vectorAlmostZero)(t.size))return{intersects:!1};return Z({vertices:y(t)},e)},e.polygonIntersectsPolygon=Z;const a=n(395),u=n(430),l=o(n(513)),v=n(955),f=o(n(388)),h=n(233);function d(t,e,n){const r=.5*Math.abs(t.x*(e.y-n.y)+e.x*(n.y-t.y)+n.x*(t.y-e.y));return Math.abs(r)<f.EPSILON}function m(t,e=1){return{start:t.origin,end:u.vec2.add(t.origin,u.vec2.mul(t.direction,e))}}function p(t){return void 0!==t.rotation&&Math.abs(t.rotation)>f.EPSILON}function y(t){const{position:e,size:n,rotation:r=0}=t,s=u.vec2.div(n,2);let i=u.vec2.fromComponents(u.vec2.swiz(s,"XY")),o=u.vec2.fromComponents(u.vec2.swiz(s,"xY")),c=u.vec2.fromComponents(u.vec2.swiz(s,"xy")),a=u.vec2.fromComponents(u.vec2.swiz(s,"Xy"));return p(t)&&(i=u.vec2.rot(i,r),o=u.vec2.rot(o,r),c=u.vec2.rot(c,r),a=u.vec2.rot(a,r)),[u.vec2.add(e,i),u.vec2.add(e,o),u.vec2.add(e,c),u.vec2.add(e,a)]}function x(t){const e=[];for(let n=0;n<t.length;n++){const r=t[n],s=(0,a.at)(t,n+1);e.push({start:r,end:s})}return e}function g(t){const e=t.flatMap((t=>x(t.vertices))),n=(t,e)=>{const n=k(t,e);return!(!n.intersects||n.intersectionPoint||(0,v.vectorsAlmostEqual)(t.end,e.start)&&!(0,v.vectorsAlmostEqual)(t.start,e.end)||(0,v.vectorsAlmostEqual)(t.start,e.end)&&!(0,v.vectorsAlmostEqual)(t.end,e.start))},r=[];for(const t of e)r.some((e=>n(e,t)))||e.some((e=>e!==t&&n(e,t)))||r.push(t);return r}function b(t){if(!P(t))return null;let e=0;for(let n=0;n<t.vertices.length;n++){const r=t.vertices[n],s=(0,a.at)(t.vertices,n+1),i=(0,a.at)(t.vertices,n+2),o=(s.x-r.x)*(i.y-r.y)-(s.y-r.y)*(i.x-r.x);if(0!==o)if(0===e)e=Math.sign(o);else if(Math.sign(o)!==e)return!1}return!0}function M(t){if(t.vertices.length<3)return!1;const e=t.vertices.length;for(let n=0;n<e;n++){const r=t.vertices[n],s=(0,a.at)(t.vertices,n+1);for(let i=n+2;i<e;i++){const o=t.vertices[i],c=(0,a.at)(t.vertices,i+1);if(0===n&&i===e-1)continue;const{intersects:u}=k({start:r,end:s},{start:o,end:c});if(u)return!0}}return!1}function P(t){return t.vertices.length>=3&&!M(t)}function z(t,e){if(!P(t))return null;let n=0;for(let e=0;e<t.vertices.length;e++){const r=t.vertices[e],s=(0,a.at)(t.vertices,e+1);n+=(s.x-r.x)*(s.y+r.y)}switch((null==e?void 0:e.coordinateSystem)||"screen"){case"cartesian":return n>0?"clockwise":"counter-clockwise";case"screen":return n>0?"counter-clockwise":"clockwise";default:return null}}function I(t){return P(t)?t.vertices.every(((t,e,n)=>d(t,(0,a.at)(n,e+1),(0,a.at)(n,e+2))))?null:u.vec2.div([...t.vertices].reduce(((t,e)=>u.vec2.add(t,e)),(0,u.vec2)()),t.vertices.length):null}function O(t){const e=[],n=t.length;for(let r=0;r<n;r++){const n=t[r];e.some((t=>(0,v.vectorsAlmostEqual)(n,t)))||e.push(n)}return e}function S(t,e){var n;if(!P(t))return null;if(b(t))return[t];const r=(null==e?void 0:e.mode)||"fast",s=null===(n=null==e?void 0:e.keepWindingOrder)||void 0===n||n,i=z(t),o=t.vertices.map((t=>[t.x,t.y]));"counter-clockwise"===i&&o.reverse();let c=[];switch(r){case"fast":c=l.quickDecomp(o);break;case"optimal":c=l.decomp(o)}const a=[];for(const t of c)a.push({vertices:t.map((t=>(0,u.vec2)(t[0],t[1])))});if(s)for(const t of a)z(t)!==i&&t.vertices.reverse();return a.length>0?a:null}function E(t,e){const n=u.vec2.sub(e.end,e.start),r=u.vec2.nor(n),s=u.vec2.sub(t,e.start),i=u.vec2.dot(s,r),o=u.vec2.len(n),c=Math.max(0,Math.min(o,i)),a=u.vec2.add(e.start,u.vec2.mul(r,c)),l=u.vec2.len(u.vec2.sub(t,a));return{intersects:l<f.EPSILON,closestPoint:a,distance:l}}function L(t,e){const n=u.vec2.sub(t,e.position),r=u.vec2.len(n),s=r<=e.radius,i=s?-(e.radius-r):r-e.radius;return{intersects:s,closestPoint:u.vec2.add(e.position,u.vec2.mul(u.vec2.nor(n),e.radius)),distance:i}}function N(t,e){if((0,v.vectorAlmostZero)(e.size)){const n=(0,v.vectorsAlmostEqual)(t,e.position);return{intersects:n,closestPoint:e.position,distance:n?0:u.vec2.len(u.vec2.sub(t,e.position))}}const n=A(t,{vertices:y(e)});if(!n)throw new Error("Invalid rectangle vertices");return n}function A(t,e){if(!P(e))return null;let n=!1;const r=e.vertices;let s=1/0,i=t;for(let e=0;e<r.length;e++){const o=(e+1)%r.length,c=r[e],a=r[o];c.y>t.y!=a.y>t.y&&t.x<(a.x-c.x)*(t.y-c.y)/(a.y-c.y)+c.x&&(n=!n);const u={start:c,end:a},{closestPoint:l,distance:v}=E(t,u),f=v*v;f<s&&(s=f,i=l)}const o=Math.sqrt(s);return{intersects:n,closestPoint:i,distance:n?-o:o}}function j(t,e){const n=u.vec2.sub(e.end,e.start),r=u.vec2.nor(t.direction);if((0,v.vectorAlmostZero)(n)||(0,v.vectorAlmostZero)(r))return{intersects:!1};const s=u.vec2.cross(r,n),i=u.vec2.sub(e.start,t.origin);if(Math.abs(s)<f.EPSILON){if(Math.abs(u.vec2.cross(i,r))<f.EPSILON){const s=u.vec2.dot(u.vec2.sub(e.start,t.origin),r),i=u.vec2.dot(u.vec2.sub(e.end,t.origin),r);if((s>=0||i>=0)&&Math.min(s,i)<=u.vec2.len(n))return{intersects:!0}}return{intersects:!1}}const o=u.vec2.cross(i,n)/s,c=u.vec2.cross(i,r)/s;return o>=0&&c>=0&&c<=1?{intersects:!0,intersectionPoint:u.vec2.add(t.origin,u.vec2.mul(r,o))}:{intersects:!1}}function w(t,e){let n=[];const r=x(y(e));for(const e of r){const r=j(t,e);r.intersects&&r.intersectionPoint&&n.push(r.intersectionPoint)}if(n=O(n),n.length>1){const e=u.vec2.nor(t.direction);n.sort(((n,r)=>u.vec2.dot(u.vec2.sub(n,t.origin),e)-u.vec2.dot(u.vec2.sub(r,t.origin),e)))}return{intersects:n.length>0,intersectionPoints:n.length>0?n:void 0}}function _(t,e){let n=[];for(const r of e){const e=j(t,r);e.intersects&&e.intersectionPoint&&n.push(e.intersectionPoint)}if(n=O(n),n.length>1){const e=u.vec2.nor(t.direction);n.sort(((n,r)=>u.vec2.dot(u.vec2.sub(n,t.origin),e)-u.vec2.dot(u.vec2.sub(r,t.origin),e)))}return{intersects:n.length>0,intersectionPoints:n.length>0?n:void 0}}function k(t,e){const n=u.vec2.sub(t.end,t.start),r=u.vec2.sub(e.end,e.start);if((0,v.vectorAlmostZero)(n)||(0,v.vectorAlmostZero)(r))return{intersects:!1};const s=u.vec2.cross(n,r),i=u.vec2.sub(e.start,t.start);if(Math.abs(s)<f.EPSILON){if(Math.abs(u.vec2.cross(i,n))<f.EPSILON){const t=u.vec2.dot(i,n)/u.vec2.dot(n,n),e=t+u.vec2.dot(r,n)/u.vec2.dot(n,n),s=Math.min(t,e),o=Math.max(t,e);if(s<=1&&o>=0)return{intersects:!0}}return{intersects:!1}}const o=u.vec2.cross(i,r)/s,c=u.vec2.cross(i,n)/s;return o>=0&&o<=1&&c>=0&&c<=1?{intersects:!0,intersectionPoint:u.vec2.add(t.start,u.vec2.mul(n,o))}:{intersects:!1}}function q(t,e){const n=u.vec2.sub(t.end,t.start),r=u.vec2.dot(n,n);if(r<f.EPSILON)return{intersects:!1};if(L(t.start,e).intersects&&L(t.end,e).intersects)return{intersects:!0};const s=u.vec2.sub(e.position,t.start),i=r,o=2*u.vec2.dot(n,u.vec2.mul(s,-1)),c=o*o-4*i*(u.vec2.dot(s,s)-e.radius*e.radius);if(c<-f.EPSILON)return{intersects:!1};if(Math.abs(c)<f.EPSILON){const e=-o/(2*i);return e>=0&&e<=1?{intersects:!0,intersectionPoints:[u.vec2.add(t.start,u.vec2.mul(n,e))]}:{intersects:!1}}const a=Math.sqrt(c),l=(-o-a)/(2*i),v=(-o+a)/(2*i);let h=[];return v<0||l>1?{intersects:!1}:(l>=0&&l<=1&&h.push(u.vec2.add(t.start,u.vec2.mul(n,l))),v>=0&&v<=1&&h.push(u.vec2.add(t.start,u.vec2.mul(n,v))),h=O(h),h.length>1&&h.sort(((e,n)=>u.vec2.len(u.vec2.sub(e,t.start))-u.vec2.len(u.vec2.sub(n,t.start)))),{intersects:h.length>0,intersectionPoints:h.length>0?h:void 0})}function C(t,e,n){const r=A({x:(t.start.x+t.end.x)/2,y:(t.start.y+t.end.y)/2},e),s=A(t.start,e),i=A(t.end,e);if((null==r?void 0:r.intersects)&&(null==s?void 0:s.intersects)&&(null==i?void 0:i.intersects))return{intersects:!0};let o=[];for(const e of n){const n=k(t,e);n.intersects&&n.intersectionPoint&&o.push(n.intersectionPoint)}return o=O(o),o.length>1&&o.sort(((e,n)=>u.vec2.len(u.vec2.sub(e,t.start))-u.vec2.len(u.vec2.sub(n,t.start)))),{intersects:o.length>0,intersectionPoints:o.length>0?o:void 0}}function R(t,e,n,r){let s=[];for(const n of e){const e=q(n,t);e.intersects&&e.intersectionPoints&&s.push(...e.intersectionPoints)}return(n||r)&&0===s.length?{intersects:!0}:(s=O(s),{intersects:s.length>0,intersectionPoints:s.length>0?s:void 0})}function V(t,e){let n=1/0,r=-1/0;for(const s of t){const t=u.vec2.dot(s,e);n=Math.min(n,t),r=Math.max(r,t)}return{min:n,max:r}}function Z(t,e){if(!P(t)||!P(e))return null;let n=[];if(b(t))n=[t];else{const e=S(t);if(!e)return null;n=e}let r=[];if(b(e))r=[e];else{const t=S(e);if(!t)return null;r=t}const s=g(n),i=g(r),o=[];for(const t of s)for(const e of i){const n=k(t,e);n.intersects&&n.intersectionPoint&&o.push(n.intersectionPoint)}if(0===o.length){if(n.map(I).filter((t=>!!t)).every((t=>{var n;return null===(n=A(t,e))||void 0===n?void 0:n.intersects})))return{intersects:!0};if(r.map(I).filter((t=>!!t)).every((e=>{var n;return null===(n=A(e,t))||void 0===n?void 0:n.intersects})))return{intersects:!0}}const c=O(o);return{intersects:c.length>0,intersectionPoints:c.length>0?c:void 0}}c(n(233),e)},233:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isPoint=s,e.isRay=function(t){return t&&"object"==typeof t&&"origin"in t&&s(t.origin)&&"direction"in t&&(0,r.isVec2)(t.direction)},e.isLine=function(t){return t&&"object"==typeof t&&"start"in t&&s(t.start)&&"end"in t&&s(t.end)},e.isCircle=function(t){return t&&"object"==typeof t&&"position"in t&&s(t.position)&&"radius"in t&&"number"==typeof t.radius},e.isAABB=function(t){return t&&"object"==typeof t&&"position"in t&&s(t.position)&&"size"in t&&(0,r.isVec2)(t.size)},e.isRectangle=function(t){return t&&"object"==typeof t&&"position"in t&&s(t.position)&&"size"in t&&(0,r.isVec2)(t.size)&&(!("rotation"in t)||"number"==typeof t.rotation)},e.isPolygon=function(t){return t&&"object"==typeof t&&"vertices"in t&&Array.isArray(t.vertices)&&t.vertices.every(s)};const r=n(197);function s(t){return(0,r.isVec2)(t)}},388:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EPSILON=void 0,e.EPSILON=1e-6},955:function(t,e,n){"use strict";var r,s=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var s=Object.getOwnPropertyDescriptor(e,n);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,s)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),i=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),o=this&&this.__importStar||(r=function(t){return r=Object.getOwnPropertyNames||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[e.length]=n);return e},r(t)},function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n=r(t),o=0;o<n.length;o++)"default"!==n[o]&&s(e,t,n[o]);return i(e,t),e}),c=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||s(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),e.vectorAlmostZero=function(t){return(0,u.isVec3)(t)?Math.abs(t.x)<a.EPSILON&&Math.abs(t.y)<a.EPSILON&&Math.abs(t.z)<a.EPSILON:!!(0,u.isVec2)(t)&&Math.abs(t.x)<a.EPSILON&&Math.abs(t.y)<a.EPSILON},e.vectorsAlmostEqual=function(t,e){return(0,u.isVec3)(t)&&(0,u.isVec3)(e)?Math.abs(t.x-e.x)<a.EPSILON&&Math.abs(t.y-e.y)<a.EPSILON&&Math.abs(t.z-e.z)<a.EPSILON:!(!(0,u.isVec2)(t)||!(0,u.isVec2)(e))&&Math.abs(t.x-e.x)<a.EPSILON&&Math.abs(t.y-e.y)<a.EPSILON},e.valueInInterval=function(t,e){const{min:n,minInclusive:r=!0,max:s,maxInclusive:i=!0}=e;return(r?t>=n:t>n)&&(i?t<=s:t<s)},e.intervalsOverlap=l,e.overlapInterval=function(t,e){return l(t,e)?{min:Math.max(t.min,e.min),max:Math.min(t.max,e.max)}:null};const a=o(n(388)),u=n(197);function l(t,e){return Math.max(t.min,e.min)<=Math.min(t.max,e.max)}c(n(197),e)},197:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isVec2=function(t){return t&&"object"==typeof t&&"x"in t&&"number"==typeof t.x&&"y"in t&&"number"==typeof t.y&&!("z"in t)},e.isVec3=function(t){return t&&"object"==typeof t&&"x"in t&&"number"==typeof t.x&&"y"in t&&"number"==typeof t.y&&"z"in t&&"number"==typeof t.z}}},e={},function n(r){var s=e[r];if(void 0!==s)return s.exports;var i=e[r]={exports:{}};return t[r].call(i.exports,i,i.exports,n),i.exports}(674);var t,e}));